
&НаСервере
Процедура ПриСозданииНаСервере ( Отказ, СтандартнаяОбработка )
	
	УстановитьПривилегированныйРежим ( ИСТИНА );
	пользователь = ПользователиИнформационнойБазы.ТекущийПользователь ();
	ПользовательИБ = пользователь.Имя;
	ИДПользователя = пользователь.УникальныйИдентификатор; 
	УстановитьПривилегированныйРежим ( ЛОЖЬ );
	
КонецПроцедуры

&НаКлиенте
Процедура ОК ( Команда )
	
	проверитьВвод ();
	
КонецПроцедуры

&НаКлиенте
Процедура проверитьВвод ()
	
	результат = проверитьПароль ();
	Если ( результат ) Тогда
		Закрыть ();
		п = Новый Структура ();
		п.Вставить ( "ИДПользователя", ИДПользователя );
		п.Вставить ( "ТекущийПользователь", ИСТИНА );
		ОткрытьФорму ( "Обработка.ИзменитьПароль.Форма.ВводПароля", п, , , , , , РежимОткрытияОкнаФормы.БлокироватьВесьИнтерфейс );	
	Иначе
		Пароль = "";
	КонецЕсли;
	
КонецПроцедуры 

&НаСервере
Функция проверитьПароль ()
	
	результат = ЛОЖЬ;
	УстановитьПривилегированныйРежим ( ИСТИНА );
	пользователь = ПользователиИнформационнойБазы.ТекущийПользователь ();
	хеш = пользователь.СохраняемоеЗначениеПароля;
	хешНовый = Обработки.ИзменитьПароль.ПолучитьХешПароля ( пароль );
	Если ( хешНовый = хеш ) Тогда
		результат = ИСТИНА;
	Иначе
		результат = ЛОЖЬ;
		ТекущийЭлемент = Элементы.Пароль;
	КонецЕсли; 
	УстановитьПривилегированныйРежим ( ЛОЖЬ );
	Возврат результат;
	
КонецФункции

&НаКлиенте
Процедура ПарольПриИзменении ( Элемент )

	проверитьВвод ();
	
КонецПроцедуры